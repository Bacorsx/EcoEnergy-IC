{% extends "base.html" %}
{% block title %}Alertas{% endblock %}
{% block content %}

<h2>Alertas</h2>

<div class="filters">
  <a class="btn {% if show != 'all' %}btn-dark{% else %}btn-light{% endif %}" href="?">Pendientes</a>
  <a class="btn {% if show == 'all' %}btn-dark{% else %}btn-light{% endif %}" href="?show=all">Todas</a>
</div>

<section class="card">
  {% if is_empty_alerts %}
    <p>Sin datos</p>
  {% else %}
  <table class="table">
    <thead>
      <tr>
        <th>Severidad</th>
        <th>Producto</th>
        <th>Dispositivo</th>
        <th>Medición</th>
        <th>Rango</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody>
      {% for e in events %}
      <tr>
        <td>
          <span class="pill {% if e.alert.severity == 'GRAVE' %}danger{% elif e.alert.severity == 'ALTO' %}warn{% else %}muted{% endif %}">
            {{ e.alert.severity }}
          </span>
        </td>
        <td><a href="{% url 'dispositivos:product_detail' e.product.pk %}">{{ e.product.name }}</a></td>
        <td>
          {% if e.product.device %}
            <a href="{% url 'dispositivos:device_detail' e.product.device.pk %}">{{ e.product.device.name }}</a>
          {% else %}—{% endif %}
        </td>
        <td>{{ e.measurement.value }} {{ e.measurement.unit }} ({{ e.measurement.measured_at|date:"d/m/Y H:i" }})</td>
        <td>{{ e.range_min }} – {{ e.range_max }} {{ e.unit }}</td>
        <td>
          {% if e.is_resolved %}
            <span class="tag tag-muted">Resuelta</span>
          {% else %}
            <form method="post" action="{% url 'dispositivos:resolve_event' e.pk %}">
              {% csrf_token %}
              <button class="btn btn-light" type="submit">Marcar resuelta</button>
            </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</section>

{% endblock %}
